<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>GroundVu POC</title>

  <script>
    var dojoConfig = {
      has: {
        // WebGL (BETA) is cool, let's use by default
        "esri-featurelayer-webgl": 1
      }
    };
  </script>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.7/esri/css/main.css">

  <script src="https://js.arcgis.com/4.7/"></script>

  <script>
    require([
      "esri/views/MapView",
      "esri/WebMap",
      "esri/widgets/Expand",
      "esri/widgets/BasemapGallery",
      "esri/widgets/LayerList",
      "esri/widgets/Legend",
      "dojo/domReady!"
    ], function(
      MapView, WebMap, Expand, BasemapGallery, LayerList, Legend
    ) {

      const getUrl = imgNumber => `http://sftp.ground.vu/StreetScape/0.4/m8glqr5hg/withMap/index.html?scene=/client/Phillips76_39502/ManhattanBeach_4_16_18/webScene.json&image=${imgNumber}&haveMap=false`

      const webmap = new WebMap({
        portalItem: {
          id: "ea2e38eba7324b7890fcc7ee2c7654a8"
        }
      });

      const view = new MapView({
        map: webmap,
        container: "viewDiv",
        constraints: {
          snapToZoom: false
        }
      });
      
      fetch('http://sftp.ground.vu/client/Phillips76_39502/ManhattanBeach_4_16_18/shotData.json')
        .then(res => res.json)
        .then(rJson => console.log(rJson))
        .catch(err => console.log(err))

      const legend = new Legend({
        view: view,
        container: document.createElement("div")
      })
      const legendExpand = new Expand({
        view: view,
        content: legend.domNode,
        expandIconClass: "esri-icon-feature-layer",
        expanded: true
      })

      const layerList = new LayerList({
        view: view,
        container: document.createElement("div")
      })
      const listExpand = new Expand({
        view: view,
        content: layerList.domNode,
        expandIconClass: "esri-icon-layer-list"
      })
      
      const basemapGallery = new BasemapGallery({
        view: view,
        container: document.createElement("div")
      })
      const bgExpand = new Expand({
        view: view,
        content: basemapGallery.domNode,
        expandIconClass: "esri-icon-basemap"
      })
      
      const expWidgets = [legendExpand, listExpand, bgExpand]

      let activeExpand = legendExpand;
      const setActiveExpand = (nV, oV, expProp, expObj) => {
        if(nV === true && expObj !== activeExpand){
          activeExpand.expanded = false
          activeExpand = expObj
        }
      }

      expWidgets.forEach(w => {
        w.watch("expanded", setActiveExpand)
      })

      view.ui.add(expWidgets, "top-right")


    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>